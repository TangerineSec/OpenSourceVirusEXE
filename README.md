# 1ã€ğŸ˜€åŸºäºPythonç¼–ç¨‹çš„æ”»å‡»åŸç†

## ä¸€ã€ğŸ˜€ä»€ä¹ˆæ˜¯dll

â€‹    åŠ¨æ€é“¾æ¥åº“ï¼ˆDynamic Link Library æˆ–è€… Dynamic-link Libraryï¼Œç¼©å†™ä¸º DLLï¼‰ï¼Œæ˜¯å¾®è½¯å…¬å¸åœ¨å¾®è½¯Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œå®ç°å…±äº«å‡½æ•°åº“æ¦‚å¿µçš„ä¸€ç§æ–¹å¼ã€‚è¿™äº›åº“å‡½æ•°çš„æ‰©å±•åæ˜¯ â€.dll"ã€".ocx"ï¼ˆåŒ…å«ActiveXæ§åˆ¶çš„åº“ï¼‰æˆ–è€… ".drv"ï¼ˆæ—§å¼çš„ç³»ç»Ÿé©±åŠ¨ç¨‹åºï¼‰ã€‚

## äºŒã€ğŸ¤£ä¸ºä½•è¦æœ‰dll

â€‹    ç”±äºè¿›ç¨‹çš„åœ°å€ç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰ï¼Œå½“å¤šä¸ªè¿›ç¨‹å…±äº«ç›¸åŒçš„åº“æ—¶ï¼Œæ¯ä¸ªåº“éƒ½åœ¨ç¡¬ç›˜å’Œè¿›ç¨‹å½¼æ­¤çš„å†…å­˜ã€‚å­˜æ”¾ä¸€ä»½çš„è¯ï¼Œå¯¹äºæ—©æœŸçš„è®¡ç®—æœºæ¥è¯´ï¼Œè€Œè¿™æ˜¯ä¸€ç§æå¤§çš„æµªè´¹ï¼Œäºæ˜¯windowsç³»ç»Ÿæ¨å‡ºäº†dllæœºåˆ¶ï¼Œdllåœ¨ç¡¬ç›˜ä¸Šå­˜ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨å†…å­˜ä¸­ä½¿ç”¨ä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰ã€‚

> è¯¦ç»†å¦‚ä¸‹ï¼š
> åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œè¿è¡Œçš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½ç”Ÿæ´»åœ¨è‡ªå·±çš„ç¨‹åºç©ºé—´ä¸­ï¼ˆä¿æŠ¤æ¨¡å¼ï¼‰ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½è®¤ä¸ºè‡ªå·±æ‹¥æœ‰æ•´ä¸ªæœºå™¨çš„æ§åˆ¶æƒï¼Œ
> æ¯ä¸ªè¿›ç¨‹éƒ½è®¤ä¸ºè‡ªå·±æ‹¥æœ‰è®¡ç®—æœºçš„æ•´ä¸ªå†…å­˜ç©ºé—´ï¼Œè¿™äº›å‡è±¡éƒ½æ˜¯æ“ä½œç³»ç»Ÿåˆ›é€ çš„ï¼ˆæ“ä½œç³»ç»Ÿæ§åˆ¶CPUä½¿å¾—CPUå¯ç”¨ä¿æŠ¤æ¨¡å¼ï¼‰ã€‚
> ç†è®ºä¸Šè€Œè¨€ï¼Œè¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„æ¯ä¸€ä¸ªè¿›ç¨‹ä¹‹é—´éƒ½æ˜¯äº’ä¸å¹²æ‰°çš„ï¼Œå³æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚æ¯”å¦‚è¯´è¿›ç¨‹Bä¿®æ”¹äº†åœ°å€ä¸º0x4000000çš„æ•°æ®ï¼Œ
> é‚£ä¹ˆè¿›ç¨‹Cçš„åœ°å€ä¸º0x4000000å¤„çš„æ•°æ®å¹¶æœªéšç€Bçš„ä¿®æ”¹è€Œå‘ç”Ÿæ”¹å˜ï¼Œå¹¶ä¸”è¿›ç¨‹Cå¯èƒ½å¹¶ä¸æ‹¥æœ‰åœ°å€ä¸º0x4000000çš„å†…å­˜(æ“ä½œç³»ç»Ÿå¯èƒ½æ²¡æœ‰ä¸ºè¿›ç¨‹Cæ˜ å°„è¿™å—å†…å­˜)ã€‚
> å› æ­¤ï¼Œå¦‚æœæŸè¿›ç¨‹æœ‰ä¸€ä¸ªç¼ºé™·è¦†ç›–äº†éšæœºåœ°å€å¤„çš„å†…å­˜(è¿™å¯èƒ½å¯¼è‡´ç¨‹åºè¿è¡Œå‡ºç°é—®é¢˜)ï¼Œé‚£ä¹ˆè¿™ä¸ªç¼ºé™·å¹¶ä¸ä¼šå½±å“åˆ°å…¶ä»–è¿›ç¨‹æ‰€ä½¿ç”¨çš„å†…å­˜ã€‚

## ä¸‰ã€ğŸ˜Šä»€ä¹ˆæ˜¯dllæ³¨å…¥ï¼šã€€

â€‹    æˆ‘ä»¬å¯ä»¥åˆ©ç”¨dllæœºåˆ¶æ¥å®è®­è¿›ç¨‹é€šä¿¡æˆ–æ§åˆ¶å…¶å®ƒè¿›ç¨‹çš„åº”ç”¨ç¨‹åºã€‚è€Œæ‰€è°“çš„dllæ³¨å…¥æ­£æ˜¯æ˜¯è®©è¿›ç¨‹Aå¼ºè¡ŒåŠ è½½ç¨‹åºBç»™å®šçš„a.dllï¼Œå¹¶æ‰§è¡Œç¨‹åºBç»™å®šçš„a.dllé‡Œé¢çš„ä»£ç ï¼Œä»è€Œè¾¾åˆ°Aè¿›ç¨‹æ§åˆ¶Bè¿›ç¨‹çš„ç›®çš„ã€‚

> æ³¨æ„ï¼Œç¨‹åºBæ‰€ç»™å®šçš„a.dllåŸå…ˆå¹¶ä¸ä¼šè¢«ç¨‹åºAä¸»åŠ¨åŠ è½½ï¼Œä½†æ˜¯å½“ç¨‹åºBé€šè¿‡æŸç§æ‰‹æ®µè®©ç¨‹åºAâ€œåŠ è½½â€a.dllåï¼Œç¨‹åºAå°†ä¼šæ‰§è¡Œa.dllé‡Œçš„ä»£ç ï¼Œæ­¤æ—¶ï¼Œa.dllå°±è¿›å…¥äº†ç¨‹åºAçš„åœ°å€ç©ºé—´ï¼Œè€Œa.dllæ¨¡å—çš„ç¨‹åºé€»è¾‘ç”±ç¨‹åºBçš„å¼€å‘è€…è®¾è®¡ï¼Œå› æ­¤ç¨‹åºBçš„å¼€å‘è€…å¯ä»¥å¯¹ç¨‹åºAä¸ºæ‰€æ¬²ä¸ºã€‚

## å››ã€ğŸ¥°ä»€ä¹ˆæ—¶å€™éœ€è¦dllæ³¨å…¥

ã€€ã€€åº”ç”¨ç¨‹åºä¸€èˆ¬ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨dllæ³¨å…¥æŠ€æœ¯æ¥å®ŒæˆæŸäº›åŠŸèƒ½ï¼š

- 1.ä¸ºç›®æ ‡è¿›ç¨‹æ·»åŠ æ–°çš„â€œå®ç”¨â€åŠŸèƒ½ï¼›
- 2.éœ€è¦ä¸€äº›æ‰‹æ®µæ¥è¾…åŠ©è°ƒè¯•è¢«æ³¨å…¥dllçš„è¿›ç¨‹ï¼›
- 3.ä¸ºç›®æ ‡è¿›ç¨‹å®‰è£…é’©å­ç¨‹åº(API Hook)ï¼›

## äº”ã€ğŸ¤—dllæ³¨å…¥çš„æ–¹æ³•

ã€€ã€€ä¸€èˆ¬æƒ…å†µä¸‹æœ‰å¦‚ä¸‹dllæ³¨å…¥æ–¹æ³•ï¼šã€€ã€€ã€€ã€€
ã€€ã€€ã€€ã€€1.ä¿®æ”¹æ³¨å†Œè¡¨æ¥æ³¨å…¥dllï¼›
ã€€ã€€ã€€ã€€2.ä½¿ç”¨CreateRemoteThreadå‡½æ•°å¯¹è¿è¡Œä¸­çš„è¿›ç¨‹æ³¨å…¥dllï¼›
ã€€ã€€ã€€ã€€3.ä½¿ç”¨SetWindowsHookExå‡½æ•°å¯¹åº”ç”¨ç¨‹åºæŒ‚é’©(HOOK)è¿«ä½¿ç¨‹åºåŠ è½½dllï¼›
ã€€ã€€ã€€ã€€4.æ›¿æ¢åº”ç”¨ç¨‹åºä¸€å®šä¼šä½¿ç”¨çš„dllï¼›
ã€€ã€€ã€€ã€€5.æŠŠdllä½œä¸ºè°ƒè¯•å™¨æ¥æ³¨å…¥ï¼›
ã€€ã€€ã€€ã€€6.ç”¨CreateProcesså¯¹å­è¿›ç¨‹æ³¨å…¥dll
ã€€ã€€ã€€ã€€7.ä¿®æ”¹è¢«æ³¨å…¥è¿›ç¨‹çš„exeçš„å¯¼å…¥åœ°å€è¡¨ã€‚
    psï¼š
        æ€æ¯’è½¯ä»¶å¸¸ç”¨é’©å­æ¥è¿›è¡Œå¤„ç†

## å…­ã€ğŸ˜ªä½¿ç”¨SetWindowsHookExå‡½æ•°å¯¹åº”ç”¨ç¨‹åºæŒ‚é’©(HOOK)è¿«ä½¿ç¨‹åºåŠ è½½dll

â€‹    ctypesæ˜¯Pythonçš„å¤–éƒ¨å‡½æ•°åº“ï¼Œä»Python2.5å¼€å§‹å¼•å…¥ã€‚å®ƒæä¾›äº†Cå…¼å®¹çš„æ•°æ®ç±»å‹ï¼Œå¹¶ä¸”å…è®¸è°ƒç”¨åŠ¨æ€é“¾æ¥åº“/å…±äº«åº“ä¸­çš„å‡½æ•°ã€‚å®ƒå¯ä»¥å°†è¿™äº›åº“åŒ…è£…èµ·æ¥ç»™Pythonä½¿ç”¨ã€‚

    ctypes.windll.user32ä¸‹ä¸»è¦ç”¨åˆ°ä¸‰ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯SetWindowsHookEx() ã€CallNextHookEx()å’ŒUnhookWindowsHookEx()

ã€€ã€€æ¶ˆæ¯é’©å­ï¼šWindowsæ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·æä¾›äº†GUI(Graphic User Interfaceï¼Œå›¾å½¢ç”¨æˆ·ç•Œé¢)ï¼Œ
å®ƒä»¥äº‹ä»¶é©±åŠ¨æ–¹å¼å·¥ä½œã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­å€ŸåŠ©é”®ç›˜ã€é¼ æ ‡ã€é€‰æ‹©èœå•ã€æŒ‰é’®ã€ç§»åŠ¨é¼ æ ‡ã€æ”¹å˜çª—å£å¤§å°ä¸ä½ç½®ç­‰éƒ½æ˜¯äº‹ä»¶ã€‚
å‘ç”Ÿè¿™æ ·çš„äº‹ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠäº‹å…ˆå®šä¹‰å¥½çš„æ¶ˆæ¯å‘é€ç»™ç›¸åº”çš„åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºåˆ†ææ”¶åˆ°çš„ä¿¡æ¯åä¼šæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•²å‡»é”®ç›˜æ—¶ï¼Œæ¶ˆæ¯ä¼šä»æ“ä½œç³»ç»Ÿç§»åŠ¨åˆ°åº”ç”¨ç¨‹åºã€‚
æ‰€è°“çš„æ¶ˆæ¯é’©å­å°±æ˜¯åœ¨æ­¤æœŸé—´å·çœ‹è¿™äº›ä¿¡æ¯ã€‚ä»¥é”®ç›˜è¾“å…¥äº‹ä»¶ä¸ºä¾‹ï¼Œæ¶ˆæ¯çš„æµå‘å¦‚ä¸‹ï¼š

- 1.å‘ç”Ÿé”®ç›˜è¾“å…¥æ—¶ï¼ŒWM_KEYDOWNæ¶ˆæ¯è¢«æ·»åŠ åˆ°æ“ä½œç³»ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼›
- 2.æ“ä½œç³»ç»Ÿåˆ¤æ–­è¿™ä¸ªæ¶ˆæ¯äº§ç”Ÿäºå“ªä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶å°†è¿™ä¸ªæ¶ˆæ¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºï¼Œæ·»åŠ åˆ°ç›¸åº”çš„åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­;
- 3.åº”ç”¨ç¨‹åºä»è‡ªå·±çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºWM_KEYDOWNæ¶ˆæ¯å¹¶è°ƒç”¨ç›¸åº”çš„å¤„ç†ç¨‹åºã€‚
  å½“æˆ‘ä»¬çš„é’©å­ç¨‹åºå¯ç”¨åï¼Œæ“ä½œç³»ç»Ÿåœ¨å°†æ¶ˆæ¯å‘é€ç»™ç”¨ç”¨ç¨‹åºå‰ä¼šå…ˆå‘é€ç»™æ¯ä¸€ä¸ªæ³¨å†Œäº†ç›¸åº”é’©å­ç±»å‹çš„é’©å­å‡½æ•°ã€‚é’©å­å‡½æ•°å¯ä»¥å¯¹è¿™ä¸€æ¶ˆæ¯åšå‡ºæƒ³è¦çš„å¤„ç†(ä¿®æ”¹ã€æ‹¦æˆªç­‰ç­‰)ã€‚å¤šä¸ªæ¶ˆæ¯é’©å­å°†æŒ‰ç…§å®‰è£…é’©å­çš„å…ˆåé¡ºåºè¢«è°ƒç”¨ï¼Œè¿™äº›æ¶ˆæ¯é’©å­åœ¨ä¸€èµ·ç»„æˆäº†"é’©é“¾"ã€‚æ¶ˆæ¯åœ¨é’©é“¾ä¹‹é—´ä¼ é€’æ—¶ä»»ä¸€é’©å­å‡½æ•°æ‹¦æˆªäº†æ¶ˆæ¯ï¼Œæ¥ä¸‹æ¥çš„é’©å­å‡½æ•°(åŒ…æ‹¬åº”ç”¨ç¨‹åº)å°†éƒ½ä¸å†æ”¶åˆ°è¯¥æ¶ˆæ¯ã€‚
    ã€€ã€€åƒè¿™æ ·çš„æ¶ˆæ¯é’©å­åŠŸèƒ½æ˜¯Windowsæä¾›çš„æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼ŒMS Visual Studioä¸­æä¾›çš„SPY++å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸€åŠŸèƒ½æ¥å®ç°çš„ï¼ŒSPY++æ˜¯ä¸€ä¸ªååˆ†å¼ºå¤§çš„æ¶ˆæ¯é’©å–ç¨‹åºï¼Œå®ƒèƒ½å¤ŸæŸ¥çœ‹æ“ä½œç³»ç»Ÿä¸­æ¥å¾€çš„æ‰€æœ‰æ¶ˆæ¯ã€‚
    ã€€ã€€æ¶ˆæ¯é’©å­æ˜¯ä½¿ç”¨SetWindowsHookExæ¥å®ç°çš„ã€‚å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š

```python
HHOOK WINAPI SetWindowsHookEx(
  _In_ int       idHook,
  _In_ HOOKPROC  lpfn,
  _In_ HINSTANCE hMod,
  _In_ DWORD     dwThreadId
);
```

ã€€ã€€idHookå‚æ•°æ˜¯æ¶ˆæ¯é’©å­çš„ç±»å‹ï¼Œå¯ä»¥é€‰æ‹©çš„ç±»å‹åœ¨MSDNä¸­å¯ä»¥æŸ¥çœ‹åˆ°ç›¸åº”çš„å®å®šä¹‰ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³å¯¹æ‰€æœ‰çš„é”®ç›˜æ¶ˆæ¯åšæŒ‚é’©ï¼Œå…¶å–å€¼å°†æ˜¯WH_KEYBOARDï¼ŒWH_KEYBOARDè¿™ä¸ªå®çš„å€¼æ˜¯2ã€‚
ã€€ã€€lpfnå‚æ•°æ˜¯é’©å­å‡½æ•°çš„èµ·å§‹åœ°å€ï¼Œæ³¨æ„ï¼šä¸åŒçš„æ¶ˆæ¯é’©å­ç±»å‹çš„é’©å­å‡½æ•°åŸå‹æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºä¸åŒç±»å‹çš„æ¶ˆæ¯éœ€è¦çš„å‚æ•°æ˜¯ä¸åŒçš„ï¼Œå…·ä½“çš„é’©å­å‡½æ•°åŸå‹éœ€è¦æŸ¥çœ‹MSDNæ¥è·å¾—ã€‚æ³¨æ„ï¼šé’©å­å‡½æ•°å¯ä»¥åœ¨ç»“æŸå‰ä»»æ„ä½ç½®è°ƒç”¨CallNextHookExå‡½æ•°æ¥æ‰§è¡Œé’©é“¾çš„å…¶ä»–é’©å­å‡½æ•°ã€‚å½“ç„¶ï¼Œå¦‚æœä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œé’©é“¾ä¸Šçš„åç»­é’©å­å‡½æ•°å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚
ã€€ã€€hModå‚æ•°æ˜¯é’©å­å‡½æ•°æ‰€åœ¨çš„æ¨¡å—çš„æ¨¡å—å¥æŸ„ã€‚
ã€€ã€€dwThreadIdå‚æ•°ç”¨æ¥æŒ‡ç¤ºè¦å¯¹å“ªä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹å®‰è£…æ¶ˆæ¯é’©å­ã€‚å¦‚æœè¿™ä¸ªå‚æ•°ä¸º0ï¼Œå®‰è£…çš„æ¶ˆæ¯é’©å­ç§°ä¸ºâ€œå…¨å±€é’©å­â€ï¼Œæ­¤æ—¶å°†å¯¹æ‰€æœ‰çš„è¿›ç¨‹(å½“å‰çš„è¿›ç¨‹ä»¥åŠä»¥åè¦è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹)ä¸‹è¿™ä¸ªæ¶ˆæ¯é’©å­ã€‚æ³¨æ„ï¼šæœ‰çš„ç±»å‹çš„é’©å­åªèƒ½æ˜¯å…¨å±€é’©å­ã€‚
ã€€ã€€æ³¨æ„ï¼šé’©å­å‡½æ•°åº”å½“æ”¾åœ¨ä¸€ä¸ªdllä¸­ï¼Œå¹¶ä¸”åœ¨ä½ çš„è¿›ç¨‹ä¸­LoadLibraryè¿™ä¸ªdllã€‚ç„¶åå†è°ƒç”¨SetWindowsHookExå‡½æ•°å¯¹ç›¸åº”ç±»å‹çš„æ¶ˆæ¯å®‰è£…é’©å­ã€‚
ã€€ã€€å½“SetWindowsHookExå‡½æ•°è°ƒç”¨æˆåŠŸåï¼Œå½“æŸä¸ªè¿›ç¨‹ç”Ÿæˆè¿™ä¸€ç±»å‹çš„æ¶ˆæ¯æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ¤æ–­è¿™ä¸ªè¿›ç¨‹æ˜¯å¦è¢«å®‰è£…äº†é’©å­ï¼Œå¦‚æœå®‰è£…äº†é’©å­ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ç›¸å…³çš„dllæ–‡ä»¶å¼ºè¡Œæ³¨å…¥åˆ°è¿™ä¸ªè¿›ç¨‹ä¸­å¹¶å°†è¯¥dllçš„é”è®¡æ•°å™¨é€’å¢1ã€‚ç„¶åå†è°ƒç”¨å®‰è£…çš„é’©å­å‡½æ•°ã€‚æ•´ä¸ªæ³¨å…¥è¿‡ç¨‹éå¸¸æ–¹ä¾¿ï¼Œç”¨æˆ·å‡ ä¹ä¸éœ€è¦åšä»€ä¹ˆã€‚
ã€€ã€€å½“ç”¨æˆ·ä¸éœ€è¦å†è¿›è¡Œæ¶ˆæ¯é’©å–æ—¶åªéœ€è°ƒç”¨UnhookWindowsHookExå³å¯è§£é™¤å®‰è£…çš„æ¶ˆæ¯é’©å­ï¼Œå‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š


    BOOL WINAPI UnhookWindowsHookEx(
      _In_ HHOOK hhk
    );

ã€€ã€€hhkå‚æ•°æ˜¯ä¹‹å‰è°ƒç”¨SetWindowsHookExå‡½æ•°è¿”å›çš„HOOKå˜é‡/å¥æŸ„ã€‚è¿™ä¸ªå‡½æ•°è°ƒç”¨æˆåŠŸåä¼šä½¿è¢«æ³¨å…¥è¿‡dllçš„é”è®¡æ•°å™¨é€’å‡1ï¼Œå½“é”è®¡æ•°å™¨å‡åˆ°0æ—¶ç³»ç»Ÿä¼šå¸è½½è¢«æ³¨å…¥çš„dllã€‚

ã€€ã€€è¿™ç§ç±»å‹çš„dllæ³¨å…¥çš„ä¼˜ç‚¹æ˜¯æ³¨å…¥ç®€å•ï¼Œç¼ºç‚¹æ˜¯åªèƒ½å¯¹windowsæ¶ˆæ¯è¿›è¡ŒHookå¹¶æ³¨å…¥dllï¼Œè€Œä¸”æ³¨å…¥dllå¯èƒ½ä¸æ˜¯ç«‹å³è¢«æ³¨å…¥ï¼Œå› ä¸ºè¿™éœ€è¦ç›¸åº”ç±»å‹çš„äº‹ä»¶å‘ç”Ÿã€‚å…¶æ¬¡æ˜¯å®ƒä¸èƒ½è¿›è¡Œå…¶ä»–APIçš„Hookï¼Œå¦‚æœæƒ³å¯¹å…¶å®ƒçš„å‡½æ•°è¿›è¡ŒHookï¼Œä½ éœ€è¦å†åœ¨è¢«æ³¨å…¥çš„dllä¸­æ·»åŠ ç”¨äºAPI Hookçš„ä»£ç ã€‚
ã€€ã€€dllæ³¨å…¥ä»£ç åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯dllçš„æºæ–‡ä»¶ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯æ§åˆ¶å°ç¨‹åºçš„æºä»£ç ã€‚
   HMODULE Hmod = LoadLibraryA("hookdll.dll");

## ä¸ƒã€ğŸ¤¯å‡†å¤‡å·¥ä½œ

### 1ã€æœ€æ–°anocoda3.7

https://www.anaconda.com/distribution/#download-section

### 2ã€æé€Ÿä¸‹è½½å¯ä»¥æ”¹å˜æº

pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

### 3ã€å®‰è£…pywin32,å®‰è£…æ—¶æŒ‡å®šå®‰è£…ç›®å½•ï¼Œé»˜è®¤ä¸ºC:\Python37\Lib\site-packages\

https://github.com/mhammond/pywin32/releases

### 4ã€å®‰è£…opencv-python

pip install opencv-python

### 5ã€å®‰è£…pyinstallerï¼Œä¾èµ–pyin32

pip install pyinstaller

### 6ã€icoæ–‡ä»¶å‡†å¤‡å¥½

åœ¨çº¿åˆ¶ä½œ
or
https://www.easyicon.net/500133-QQ_Penguin_tencent_icon.html

### 7ã€äº†è§£ä¸€ä¸‹è¦ç”¨åˆ°çš„åŠŸèƒ½ï¼š

```python
from time import sleep,strftime
from os import listdir,remove
from os.path import exists, getsize,abspath,expanduser,basename
from sys import exit
from struct import pack
from json import dumps
from socket import socket, AF_INET, SOCK_STREAM
from win32clipboard import OpenClipboard, GetClipboardData, CloseClipboard
from win32con import HKEY_CURRENT_USER, KEY_ALL_ACCESS, REG_SZ, FILE_ATTRIBUTE_HIDDEN, WH_KEYBOARD_LL, WM_KEYDOWN
from win32api import GetConsoleTitle, RegOpenKey, RegSetValueEx, RegCloseKey, SetFileAttributes
from win32gui import FindWindow, ShowWindow
from cv2 import VideoCapture, CAP_DSHOW, imwrite, destroyAllWindows

from ctypes import windll  # windll.user32ã€windll.kernel32
from ctypes import CFUNCTYPE
from ctypes import byref
from ctypes import POINTER
from ctypes import c_int, c_void_p
from ctypes.wintypes import MSG

from threading import Timer
from threading import Thread
from threading import Lock
```

## å…«ã€ğŸ§ç¼–ç¨‹å…·ä½“æ­¥éª¤

1ã€å…ˆç¼–å†™ç—…æ¯’ç¨‹åº=ã€‹WinCoreManagerment.py

â€‹    ç›‘å¬é”®ç›˜è¾“å…¥->å¹¶è®°å½•æ—¥å¿—
â€‹    é”å®šé”®ç›˜åŠŸèƒ½
â€‹    å·æ‹åŠŸèƒ½->ä¿å­˜å›¾ç‰‡æ–‡ä»¶

    ä¸Šä¼ æ•°æ®åŠŸèƒ½ï¼šå¥—æ¥å­—å®¢æˆ·åº¦

2ã€ç¼–å†™æœåŠ¡ç«¯ï¼ˆsocketserverï¼‰

â€‹    secureCRTå›¾å½¢ç•Œé¢-ã€‹windows
â€‹    ç³»ç»Ÿè‡ªå¸¦scpå‘½ä»¤-ã€‹linux
â€‹    pythonçš„æ¨¡å—-ã€‹paramikoæ¨¡å—
â€‹    çº¯æ‰‹å†™å®¢æˆ·ç«¯å¥—æ¥å­—

3ã€æœåŠ¡ç«¯éƒ¨ç½²ï¼Œä¿®æ”¹å®‰å…¨ç»„ï¼Œå¼€å‘ç«¯å£

5ã€ç—…æ¯’ç¨‹åºåˆ¶ä½œäºŒè¿›åˆ¶

6ã€ç—…æ¯’ç¨‹åºè¿›è¡Œä¼ªè£…å¤„ç†ï¼Œå¹¶æ‰“åŒ…æˆexe

6.1 ç¼–å†™ä¼ªè£…æ–‡ä»¶ï¼š"pycharmç ´è§£ç‰ˆ.py"

6.2 ç¼–å†™æ— é™é‡å¯æ–‡ä»¶ï¼š"System.py"

6.3 æ‰“åŒ…åˆ¶ä½œäºŒè¿›åˆ¶exe

```shell
pyinstaller -i system.ico -Fw WinCoreManagement.py
pyinstaller -i system.ico -Fw System.py
pyinstaller -i pycharm.ico -Fw pycharmCrackingProgram.py
```

> æŒ‡å®š-wå‚æ•°åå°±ä¸è¦è®¾ç½®åå°è¿è¡Œäº†

6.4 å°†ä¸‰ä¸ªexeæ–‡ä»¶æ”¾å…¥æ­£å¸¸pycharmè½¯ä»¶åŒ…ä¸‹çš„binç›®å½•ä¸‹

7ã€å…³é—­Virusè¿›ç¨‹æ–¹æ³•

æ‰“å¼€å‘½ä»¤è¾“å…¥ä¸‹é¢ä¸‰è¡Œå‘½ä»¤å¯ä»¥å…³é—­ã€‚

```shell
taskkill /F /IM System.exe

taskkill /F /IM WinCoreManagement.exe

taskkill /F /IM pycharm.exe
```
